name: Build and Deploy to EC2

on:
 push:
   branches: [ "main" ]
 pull_request:
   branches: [ "main" ]


jobs:
 deploy:
   runs-on: ubuntu-latest
   steps:
     - uses: actions/checkout@v2

     - name: Set up JDK 17
       uses: actions/setup-java@v1
       with:
         java-version: 17

     - name: Grant execute permission for gradlew
       run: chmod +x ./gradlew
       shell: bash

     - name: Build
       run: ./gradlew clean build

     - name: Deploy
       uses: appleboy/ssh-action@master
       with:
         host: ${{ secrets.HOST }}
         username: ${{ secrets.USERNAME }}
         key: ${{ secrets.SSH_KEY }}
         port: 22


